@using Microsoft.AspNetCore.Authentication;
@{
    ViewData["Title"] = "E-Money Data";
    
}

<div class="row">
    <div class="col-xs-12">
        <div class="jumbotron">
            <h2>E-Money Data</h2>
            <hr>
            <p><a class="btn btn-success btn-md" asp-action="CreateEmoney" role="button"><span class="fa fa-plus" aria-hidden="true"></span> Create E-Money Data</a></p>
        </div>
    </div>
    <div class="col-xs-12">
        <div class="box">
            <div class="box-header">
            </div>
            <!-- /.box-header -->
            <div class="box-body">
                <table id="DataTable" class="table table-bordered table-hover">
                    <thead>
                        <tr>
                            <th>No.</th>
                            <th>Card Name</th>
                            <th>Provider</th>
                            <th>LogoURL</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>empty</td>
                            <td>empty</td>
                            <td>empty</td>
                            <td>empty</td>                            
                            <td style="text-align:center;">
                                <div class="btn" role="group" aria-label="...">
                                    <a href="#" class="btn btn-warning"><span class="fa fa-pencil-square-o" aria-hidden="true"></span> Edit</a>
                                    <a href="#" class="btn btn-danger"><span class="fa fa-times" aria-hidden="true"></span> Delete</a>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                    <!-- <tfoot>
                    <tr>
                      <th>Rendering engine</th>
                      <th>Browser</th>
                      <th>Platform(s)</th>
                      <th>Engine version</th>
                      <th>CSS grade</th>
                    </tr>
                    </tfoot> -->
                </table>
            </div>
            <!-- /.box-body -->
        </div>
        <!-- /.box -->
    </div>
    <!-- /.col -->
</div>
@section Scripts {
    <script>
        $(document).ready(function () {
            $.ajax({
                
                type: "GET",
                headers: { "Authorization": @await ViewContext.HttpContext.GetTokenAsync("access_token") },
                dataType: "jsonp",
                url: "http://localhost:5001/api/EMoneys",
                success: function (data) {
                    EmoneyListsucces(data);
                },
                error: function () {
                    alert('Error Call API');
                }
            });
            @*var Emoneys = @Html.Raw(@ViewBag.Json);
            if (Emoneys != '')
            {
                EmoneyListsucces(Emoneys);
            } else
            {
                alert('Empty Data');
            }*@
    });

    
        function EmoneyListsucces(data) {
            // Iterate over the collection of data  
            $("#DataTable tbody").remove();
            $.each(data, function (index, Emoney) {
                // Add a row to the employee table  
                EmoneyRow(Emoney);
            });
        }
        function EmoneyRow(Emoney)
        {
            if ($("#DataTable tbody").length == 0) {
                $("#DataTable").append("<tbody></tbody>");
            }

            // Append row to <table>  
            $("#DataTable tbody").append(
                EmoneyBuildTableRow(Emoney));

        }
        function EmoneyBuildTableRow(Emoney) {
            var newRow = "<tr>" +
                "<td>" + Emoney.id + "</td>" +
                "<td>" + Emoney.cardName + "</td>" +
                "<td>" + Emoney.provider + "</td>" +
                "<td>" + Emoney.logoUrl + "</td>" +
                "<td style='text-align:center;'>" +
                "<div class='btn' role='group'>" +
                '<a href="#" class="btn btn-warning"><span class="fa fa-pencil-square-o" aria-hidden="true"></span> Edit</a>' +
                '<a href="#" class="btn btn-danger"><span class="fa fa-times" aria-hidden="true"></span> Delete</a>' +
                 '</div>' +
                '</td>' +
                "</tr>";

            return newRow;
        }
        function handleException(request, message, error) {
            var msg = "";
            msg += "Code: " + request.status + "\n";
            msg += "Text: " + request.statusText + "\n";
            if (request.responseJSON != null) {
                msg += "Message" + request.responseJSON.Message + "\n";
            }

            alert(msg);
        }  
    </script>
}


